<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Towards Safe Policy Improvement for Non-Stationary MDPs &middot; Yash Chandak
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicons/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->


  <!-- Mathjax Support -->
  <script type="text/javascript" async
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>

</head>


  <body class="post">

    <div id="sidebar">
  <center>

  <header>
    <img src="/images/dp.jpg" alt="" width="75%" align="center" > 
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Yash Chandak
      </a>
    </div>
    <p class="lead">y[lastname]@stanford.edu</p>

  </header>

  <p>
    <br>


  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  

  

  


  
    
  

  
    
  

  
    
  

  
    
  

  

  

  
    
  

  
    
  

  
    
  

  

  


  
    
  

  
    
  

  
    
  

  
    
  

  

  

  
    
  

  

  
    
      <a class="page-link "
          href="/publication/">Publications</a>
    
  

  
    
      <a class="page-link "
          href="/about/">About Me</a>
    
  


  
    <a class="page-link "
	href="/blog/">Blog</a>
  

  <!-- Optional additional links to insert in sidebar nav -->
<!-- <a href="/docs/resume.pdf">CV/Resume</a> -->

</nav>


  <p>
    <br>
  </p>

  <!-- 
    <span class="site-version">Currently v3.4.1</span>
   -->

  <center>
<nav style="list-style: none; margin: auto; width: 85%; justify-content: center;" id="sidebar-icon-links">
  
    <a id="github-link"
       class="icon" title="Github Project" aria-label="Github Project"
       href="https://github.com/yashchandak" >
      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 28"><path d="M12 2c6.625 0 12 5.375 12 12 0 5.297-3.437 9.797-8.203 11.391-0.609 0.109-0.828-0.266-0.828-0.578 0-0.391 0.016-1.687 0.016-3.297 0-1.125-0.375-1.844-0.812-2.219 2.672-0.297 5.484-1.313 5.484-5.922 0-1.313-0.469-2.375-1.234-3.219 0.125-0.313 0.531-1.531-0.125-3.187-1-0.313-3.297 1.234-3.297 1.234-0.953-0.266-1.984-0.406-3-0.406s-2.047 0.141-3 0.406c0 0-2.297-1.547-3.297-1.234-0.656 1.656-0.25 2.875-0.125 3.187-0.766 0.844-1.234 1.906-1.234 3.219 0 4.594 2.797 5.625 5.469 5.922-0.344 0.313-0.656 0.844-0.766 1.609-0.688 0.313-2.438 0.844-3.484-1-0.656-1.141-1.844-1.234-1.844-1.234-1.172-0.016-0.078 0.734-0.078 0.734 0.781 0.359 1.328 1.75 1.328 1.75 0.703 2.141 4.047 1.422 4.047 1.422 0 1 0.016 1.937 0.016 2.234 0 0.313-0.219 0.688-0.828 0.578-4.766-1.594-8.203-6.094-8.203-11.391 0-6.625 5.375-12 12-12zM4.547 19.234c0.031-0.063-0.016-0.141-0.109-0.187-0.094-0.031-0.172-0.016-0.203 0.031-0.031 0.063 0.016 0.141 0.109 0.187 0.078 0.047 0.172 0.031 0.203-0.031zM5.031 19.766c0.063-0.047 0.047-0.156-0.031-0.25-0.078-0.078-0.187-0.109-0.25-0.047-0.063 0.047-0.047 0.156 0.031 0.25 0.078 0.078 0.187 0.109 0.25 0.047zM5.5 20.469c0.078-0.063 0.078-0.187 0-0.297-0.063-0.109-0.187-0.156-0.266-0.094-0.078 0.047-0.078 0.172 0 0.281s0.203 0.156 0.266 0.109zM6.156 21.125c0.063-0.063 0.031-0.203-0.063-0.297-0.109-0.109-0.25-0.125-0.313-0.047-0.078 0.063-0.047 0.203 0.063 0.297 0.109 0.109 0.25 0.125 0.313 0.047zM7.047 21.516c0.031-0.094-0.063-0.203-0.203-0.25-0.125-0.031-0.266 0.016-0.297 0.109s0.063 0.203 0.203 0.234c0.125 0.047 0.266 0 0.297-0.094zM8.031 21.594c0-0.109-0.125-0.187-0.266-0.172-0.141 0-0.25 0.078-0.25 0.172 0 0.109 0.109 0.187 0.266 0.172 0.141 0 0.25-0.078 0.25-0.172zM8.937 21.438c-0.016-0.094-0.141-0.156-0.281-0.141-0.141 0.031-0.234 0.125-0.219 0.234 0.016 0.094 0.141 0.156 0.281 0.125s0.234-0.125 0.219-0.219z"></path>
</svg>

    </a>
    <!-- <a id="github-download-link"
       class="icon" title="Download" aria-label="Download"
       href="https://github.com/yashchandak/archive/v3.4.1.zip">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a> -->
  

  
    <a id="twitter-link"
       class="icon" title="Twitter" aria-label="Twitter"
       href="https://twitter.com/chandakyash13">
      <?xml version="1.0" ?><!DOCTYPE svg  PUBLIC '-//W3C//DTD SVG 1.1//EN'  'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'><svg enable-background="new 0 0 56.693 56.693" height="56.693px" id="Layer_1" version="1.1" viewBox="0 0 56.693 56.693" width="56.693px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.348,5.157c-13.6,0-24.625,11.027-24.625,24.625c0,13.6,11.025,24.623,24.625,24.623c13.6,0,24.623-11.023,24.623-24.623  C52.971,16.184,41.947,5.157,28.348,5.157z M40.752,24.817c0.013,0.266,0.018,0.533,0.018,0.803c0,8.201-6.242,17.656-17.656,17.656  c-3.504,0-6.767-1.027-9.513-2.787c0.486,0.057,0.979,0.086,1.48,0.086c2.908,0,5.584-0.992,7.707-2.656  c-2.715-0.051-5.006-1.846-5.796-4.311c0.378,0.074,0.767,0.111,1.167,0.111c0.566,0,1.114-0.074,1.635-0.217  c-2.84-0.57-4.979-3.08-4.979-6.084c0-0.027,0-0.053,0.001-0.08c0.836,0.465,1.793,0.744,2.811,0.777  c-1.666-1.115-2.761-3.012-2.761-5.166c0-1.137,0.306-2.204,0.84-3.12c3.061,3.754,7.634,6.225,12.792,6.483  c-0.106-0.453-0.161-0.928-0.161-1.414c0-3.426,2.778-6.205,6.206-6.205c1.785,0,3.397,0.754,4.529,1.959  c1.414-0.277,2.742-0.795,3.941-1.506c-0.465,1.45-1.448,2.666-2.73,3.433c1.257-0.15,2.453-0.484,3.565-0.977  C43.018,22.849,41.965,23.942,40.752,24.817z"/></svg>





    </a>
  

   
    <a id="linkedin-link"
       class="icon" title="linkedin" aria-label="Linkedin"
       href="https://www.linkedin.com/in/yashchandak/">
      <?xml version="1.0" ?><!DOCTYPE svg  PUBLIC '-//W3C//DTD SVG 1.1//EN'  'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'><svg enable-background="new 0 0 56.693 56.693" height="56.693px" id="Layer_1" version="1.1" viewBox="0 0 56.693 56.693" width="56.693px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M30.071,27.101v-0.077c-0.016,0.026-0.033,0.052-0.05,0.077H30.071z"/><path d="M49.265,4.667H7.145c-2.016,0-3.651,1.596-3.651,3.563v42.613c0,1.966,1.635,3.562,3.651,3.562h42.12   c2.019,0,3.654-1.597,3.654-3.562V8.23C52.919,6.262,51.283,4.667,49.265,4.667z M18.475,46.304h-7.465V23.845h7.465V46.304z    M14.743,20.777h-0.05c-2.504,0-4.124-1.725-4.124-3.88c0-2.203,1.67-3.88,4.223-3.88c2.554,0,4.125,1.677,4.175,3.88   C18.967,19.052,17.345,20.777,14.743,20.777z M45.394,46.304h-7.465V34.286c0-3.018-1.08-5.078-3.781-5.078   c-2.062,0-3.29,1.389-3.831,2.731c-0.197,0.479-0.245,1.149-0.245,1.821v12.543h-7.465c0,0,0.098-20.354,0-22.459h7.465v3.179   c0.992-1.53,2.766-3.709,6.729-3.709c4.911,0,8.594,3.211,8.594,10.11V46.304z"/></g></svg>
    </a>
  

  
    <a id="facebook-link"
       class="icon" title="facebook" aria-label="Facebook"
       href="https://www.facebook.com/yashchandak.13">
      <?xml version="1.0" ?><!DOCTYPE svg  PUBLIC '-//W3C//DTD SVG 1.1//EN'  'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'><svg enable-background="new 0 0 56.693 56.693" height="56.693px" id="Layer_1" version="1.1" viewBox="0 0 56.693 56.693" width="56.693px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M40.43,21.739h-7.645v-5.014c0-1.883,1.248-2.322,2.127-2.322c0.877,0,5.395,0,5.395,0V6.125l-7.43-0.029  c-8.248,0-10.125,6.174-10.125,10.125v5.518h-4.77v8.53h4.77c0,10.947,0,24.137,0,24.137h10.033c0,0,0-13.32,0-24.137h6.77  L40.43,21.739z"/></svg>
    </a>
  

  
    <a id="scholar-link"
       class="icon" title="scholar" aria-label="Google Scholar"
       href="https://scholar.google.com/citations?user=OAUZgecAAAAJ&hl=en&oi=ao">
      <?xml version="1.0" ?><!DOCTYPE svg  PUBLIC '-//W3C//DTD SVG 1.1//EN'  'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'><svg height="1755" width="1755" viewBox="0 0 1755 1755" xmlns="http://www.w3.org/2000/svg"><path transform="translate(0 1610) scale(1 -1)" d="M896.76 1130.189c-27.618 30.838-59.618 46.19-95.802 46.19-40.952 0-72.382-14.738-94.288-44.15-21.906-29.322-32.864-64.848-32.864-106.584 0-35.548 5.998-71.738 18-108.64 11.958-36.886 31.524-69.814 58.954-98.838 27.334-29.096 59.144-43.616 95.284-43.616 40.288 0 71.76 13.502 94.332 40.492 22.476 26.954 33.756 60.98 33.756 101.962 0 34.904-5.954 71.454-17.906 109.664-11.894 38.262-31.752 72.784-59.466 103.52zM1658.858 1512.573c-64.358 64.424-141.86 96.57-232.572 96.57h-1097.142c-90.712 0-168.14-32.146-232.572-96.57-64.424-64.286-96.57-141.86-96.57-232.572v-1097.142c0-90.712 32.146-168.288 96.57-232.712 64.432-64.146 142-96.432 232.572-96.432h1097.142c90.712 0 168.214 32.286 232.572 96.57 64.432 64.432 96.644 141.86 96.644 232.572v1097.142c0 90.712-32.22 168.288-96.644 232.572zM1297.81 1154.159v-392.126c0-18.154-14.856-33.016-33.016-33.016h-12.156c-18.162 0-33.016 14.856-33.016 33.016v392.126c0 16.12-2.34 29.578 20.188 32.41v52.172l-173.43-142.24c2.004-3.716 3.906-6.092 5.712-9.208 15.242-26.976 23.004-60.526 23.004-101.53 0-31.43-5.238-59.662-15.858-84.598-10.57-24.928-23.428-45.29-38.43-60.972-15.002-15.74-30.048-30.128-45.092-43.074-15.046-12.976-27.904-26.506-38.436-40.55-10.614-14-15.894-28.474-15.894-43.476 0-15.024 6.854-30.288 20.524-45.67 13.62-15.426 30.376-30.376 50.19-45.144 19.85-14.666 39.658-30.946 59.472-48.662 19.858-17.694 36.52-40.456 50.14-68.096 13.722-27.744 20.568-58.288 20.568-91.86 0-44.288-11.294-84.282-33.806-119.882-22.58-35.446-51.998-63.73-88.144-84.472-36.242-20.882-75-36.6-116.334-47.214-41.42-10.518-82.52-15.806-123.568-15.806-25.908 0-52.048 1.996-78.336 6.1-26.382 4.096-52.81 11.33-79.426 21.526-26.668 10.262-50.286 22.864-70.758 37.998-20.524 14.98-37.046 34.312-49.716 57.856-12.668 23.552-18.958 50.022-18.958 79.426 0 34.882 9.714 67.24 29.192 97.404 19.478 29.944 45.282 54.952 77.378 74.76 55.998 34.838 143.858 56.364 263.432 64.498-27.334 34.172-41.048 66.334-41.048 96.432 0 17.122 4.476 35.474 13.334 55.288-14.284-1.996-28.994-3.124-44.002-3.124-64.234 0-118.476 20.882-162.524 62.932-44.046 41.976-66.048 94.522-66.048 158.048 0 6.642 0.19 12.492 0.672 18.974h-261.046l393.618 342.17h651.856l-60.24-47.024v-82.996c22.368-2.874 20.004-16.318 20.004-32.394zM900.382 544.929c-7.52 1.36-18.088 2.122-31.708 2.122-29.382 0-58.288-2.596-86.666-7.782-28.38-5.046-56.378-13.568-83.998-25.592-27.722-11.952-50.096-29.528-67.146-52.766-17.144-23.208-25.666-50.542-25.666-81.994 0-29.974 7.52-56.714 22.572-80.004 15.002-23.142 34.808-41.26 59.428-54.236 24.62-12.998 50.432-22.814 77.378-29.264 26.998-6.408 54.476-9.736 82.476-9.736 55.376 0 103.050 12.47 143.046 37.406 39.906 24.928 59.904 63.422 59.904 115.382 0 10.928-1.522 21.686-4.528 32.19-3.138 10.62-6.24 19.712-9.282 27.26-3.050 7.41-8.858 16.332-17.43 26.616-8.522 10.314-15.046 17.934-19.434 23.004-4.476 5.238-12.852 12.712-25.19 22.594-12.236 9.926-20.048 16.114-23.522 18.402-3.43 2.406-12.332 8.908-26.668 19.456-14.328 10.634-22.184 16.274-23.566 16.94z" /></svg>

    </a>
  
  <!--<a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Tags"
       href="/search.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  -->

  <!-- Optional additional links to insert for icons links -->
</nav>
 </center>
  <p style="font-size:80%;">
  <!--(Site last updated: Nov, 2023)
  <br /> -->
  <a href="https://github.com/fongandrew/hydeout">Theme by Hydeout</a>
</p>

  </center>
</div>


    <main class="container">
      <header>
  <h1 class="post-title">Towards Safe Policy Improvement for Non-Stationary MDPs</h1>
</header>
<div class="content">
  <div class="post-meta">
  <span class="post-date">24 Dec 2020</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        blog
      
    
  </span>
</div>

  <div class="post-body">
    <div class="message">
 This post is based on a NeurIPS 2020 paper that I worked on with <a href=""> Scott Jordan</a>, <a href="https://research.adobe.com/person/georgios-theocharous/"> Georgios Theocharous</a>, <a href="https://webdocs.cs.ualberta.ca/~whitem/">Martha White</a>, and <a href="https://people.cs.umass.edu/~pthomas/">Philip Thomas</a>. Here are the links for the <a href="https://arxiv.org/abs/2010.12645"> paper</a>, <a href="https://nips.cc/virtual/2020/public/poster_680390c55bbd9ce416d1d69a9ab4760d.html"> video</a>, and the <a href="https://github.com/ScottJordan/SafePolicyImprovementNonstationary">code</a>.
</div>

<p>Reinforcement learning (RL) methods have shown promise to be applicable to real-world sequential decision-making problems such as medical treatment, budget constrained bidding, and other high-risk high-reward applications. However, to actually deploying RL algorithms  for such real-world applications, safety guarantees are critical to mitigate serious risks in terms of both human-life and monetary assets. More concretely, here, by <em>safety</em> we mean that any update to a system should not reduce the performance of an existing system (e.g., a doctor’s initially prescribed treatment). A further complication is that these applications are non-stationary, which violates the foundational assumption of <em>stationarity</em> in most RL algorithms. This raises the main question we aim to address</p>

<blockquote>
  <p>How can we build sequential decision-making systems that provide safety guarantees for problems with non-stationarities?</p>
</blockquote>

<p>In this work, we merge ideas from time-series literature and model-free RL to</p>
<ul>
  <li>Formalize the safe policy improvement problem for non-stationary MDPs, and provide an algorithm for addressing it.</li>
  <li>Provide a user-controllable knob to set the desired <em>confidence level</em>: the maximum admissible probability that a worse policy will be deployed.</li>
  <li>Develop a method does not require building a model of a non-stationary MDP.</li>
</ul>

<p>However, our method is designed for environments where changes are smooth and gradual, and might not be ideal for environments where the changes are abrupt.</p>

<h2 id="problem-statement">Problem statement</h2>

<p>In a non-stationary setting, the MDP that an agent might face after deployment might be different than the ones it has encountered before. Therefore, in a non-stationary setting we need to ensure safety with respect to the future MDPs that an agent might face.  To formalize this, let <script type="math/tex">\mathcal D</script> be any available historical data and <script type="math/tex">\texttt{alg}(\mathcal D)</script> be a policy returned by an algorithm after analyzing the data.  Let <script type="math/tex">\pi^\text{safe}</script> be a known safe policy and <script type="math/tex">(1-\alpha) \in [0,1]</script> be the <em>safety level</em> desired by the user. Let <script type="math/tex">\rho(\pi, i)</script> be the performance of a policy <script type="math/tex">\pi</script> in episode <script type="math/tex">i</script> and let <script type="math/tex">k</script> be the last observed episode number such that episode numbers greater than <script type="math/tex">k</script> belong to the future. Then we aim to ensure, with high-confidence, that the future performance of the updated policy will provide improvement over the existing <script type="math/tex">\pi^\text{safe}</script>. That is,</p>

<p><br /></p>

<script type="math/tex; mode=display">\begin{align}
    \Pr \Big(\rho(\texttt{alg}(\mathcal D), {k+\delta}) \geq \rho(\pi^\text{safe}, k + \delta) \Big) \geq 1 - \alpha. 
\end{align}</script>

<p>While it is desirable to ensure the safety guarantee of the form mentioned above, obtaining a new policy from <script type="math/tex">\texttt{alg}(\mathcal D)</script> that meets this requirement might not be possible unless some more regularity assumptions are imposed on the problem.  For example, if the environment can change arbitrarily, then there is not much hope of estimating the future performance to ensure safety.</p>

<p><br />
One way to make the problem more tractable could be to assume Lipschitz smoothness on the dynamics and rewards. However, we show a negative result in the paper and discuss why Lipschitz smoothness might be insufficient for our purpose. Therefore, to make the problem more tractable, we make an alternate assumption that the performance of any policy changes <em>smoothly</em> over time. That is, let <script type="math/tex">M_i</script> be the MDP in episode <script type="math/tex">i</script> and let <script type="math/tex">\phi</script> be a non-linear basis function
(like Fourier basis, which is popular for modeling time-series trends) then</p>

<blockquote>
  <p>Assume: For every policy <script type="math/tex">\pi</script>, there exists a sequence of mean-zero and independent noises <script type="math/tex">\{\xi_i\}_{i=1}^{k+\delta}</script>, and <script type="math/tex">\exists w \in \mathbb{R}^{d \times 1}</script>, such that, <script type="math/tex">\forall i \in [1, k+\delta], \,\,\,  \rho(\pi, M_i) = \phi(i)w + \xi_i</script>.</p>
</blockquote>

<h2 id="time-series-forecasting-and-sequential-hypothesis-testing">Time-series forecasting and sequential hypothesis testing</h2>

<p>To address this problem, we build upon our  <a href="https://icml.cc/virtual/2020/poster/6316">previous work</a> on non-stationary MDPs, which combines counterfactual reasoning with curve-fitting to estimate the future performance of a policy. That is, for any policy we first estimate its performances on all the past episodes using off-policy evaluation. This <em>univariate</em> sequence of performance estimates are then analyzed to make a performance forecast based on the trend resulting due to the underlying non-stationarity (see here for a short <a href="/blog/prognosticator">blogpost</a> on that work).</p>

<p><br /></p>
<p align="center">
 <img src="/images/blog/spin/SafeNSRLidea.png" alt="idea" style="width: 65%; border-radius:0%" />
 </p>

<p>The figure above summarizes the main idea, where <script type="math/tex">\pi_c</script> is a candidate policy which could potentially be used to provide improvement over <script type="math/tex">\pi^\text{safe}</script>. The gray dots correspond to the returns, <script type="math/tex">G(\beta)</script>, observed for any behavior policy <script type="math/tex">\beta</script> that was used to collect the data. The red and the blue dots correspond to the counterfactual estimates, <script type="math/tex">\hat \rho(\pi_c)</script> and <script type="math/tex">\hat \rho(\pi^\text{safe})</script>, for performances of <script type="math/tex">\pi_c</script> and <script type="math/tex">\pi^\text{safe}</script>, respectively, in different episodes. The shaded regions correspond to the uncertainty in future performance. If we could estimate this uncertainty by analysing the trend of the counterfactual estimates for the past performances, then we could check whether the lower bound on <script type="math/tex">\pi_c</script>’s future performance is higher than the upper bound on <script type="math/tex">\pi^\text{safe}</script>’s future performance or not? If it is indeed higher, then we can say with high-confidence that <script type="math/tex">\pi_c</script> will be safe, otherwise we can say that we do not have enough confidence to provide a safe update and therefore just re-execute  <script type="math/tex">\pi^\text{safe}</script>.</p>

<p><br /></p>

<p align="center">
     <img src="/images/blog/spin/SafeNSRL.png" alt="seldonian" style="vertical-align:middle; width: 65%; margin:0px 10px; border-radius:0%" />
     </p>

<p>Given a procedure to obtain uncertainty in a policy’s future performance, the above diagram depicts the steps of the proposed algorithm to ensure safety in the presence of non-stationarity. These steps build upon the template for <a href="https://aisafety.cs.umass.edu/">Seldonian algorithms</a> and perform sequential hypothesis (A/B) testing. That is, the proposed algorithm first partitions the initial data <script type="math/tex">\mathcal D_1</script> into two sets, namely <script type="math/tex">\mathcal D_\text{train}</script> and <script type="math/tex">\mathcal D_\text{test}</script>. Subsequently, <script type="math/tex">\mathcal D_\text{train}</script> is used to search for a possible <em>candidate policy</em> <script type="math/tex">\pi_c</script> that might improve the future performance, and <script type="math/tex">\mathcal D_\text{test}</script> is used to perform a safety test on the proposed candidate policy <script type="math/tex">\pi_c</script>. The existing safe policy <script type="math/tex">\pi^\text{safe}</script> is only updated if the proposed policy <script type="math/tex">\pi_c</script> passes the safety test, and this process continues…</p>

<h2 id="uncertainty-estimation">Uncertainty estimation</h2>

<p>The above discussion of the main idea relies upon a method to quantify uncertainty in a policy’s future performance. Quantifying this uncertainty requires a careful consideration of the following three factors.</p>

<p><br /></p>
<p align="center">
     <img src="/images/blog/spin/safeNSRL_challenges.png" alt="challenges" style="vertical-align:middle; width: 75%; margin:0px 10px; border-radius:0%" />
     </p>

<ul>
  <li><em>Single sequence of MDPs</em>: Notice that we only get to observe a <em>single</em> sequence of MDPs. Further, since the MDP can change after every episode due to the underlying non-stationarity, only a <em>single</em> episode per MDP might be available.</li>
  <li><em>Heavy-tailed distributions</em>: Recall that the off-policy estimation of a policy’s performance requires the use of importance sampling that can lead to extremely heavy-tailed and asymmetric distributions.</li>
  <li><em>Heteroskedasticity</em>: Since the executed policy can be different for different MDPs in the past, the behavior policy <script type="math/tex">\beta</script> for importance sampling may be different for different episodes.  This results in heteroskedasticity, which is further exacerbated by the changes in the sources of stochasticity as the MDPs change over episodes.</li>
</ul>

<h4 id="wild-bootstrap">Wild bootstrap</h4>

<p>To quantify uncertainty in the future performance while accounting for the above factors, we leverage a technique known as <code class="highlighter-rouge">Wild bootstrap</code> from the time-series literature. This allows construction of upto <script type="math/tex">2^k</script> <em>similar</em> sequence of past performances from a single sequence of the original <script type="math/tex">k</script> performance estimates, and also tackles heteroskedasticity and non-normal distributions! Having obtained this set of similar sequences of past performances, we first compute an <em>empirical distribution</em> of future performances from it and then consequently obtain the required upper and lower bounds for the future performance. Further, under certain regularity conditions, we show in our paper that the bounds on the future performance obtained using wild-bootstrap are consistent. We outline the steps for this procedure using wild-bootstrap below:</p>

<ol>
  <li>
    <p>Let  <script type="math/tex">Y^+ := [\rho(\pi, 1), ..., \ \rho(\pi, k)]^\top \in \mathbb{R}^{k \times 1}</script> correspond to the true performances of <script type="math/tex">\pi</script>.  Create <script type="math/tex">\hat Y = \Phi(\Phi^\top  \Phi)^{-1}\Phi^\top Y</script>, a least-squares estimate of <script type="math/tex">Y^+</script>, using the counterfactual performance estimates <script type="math/tex">Y := [\hat \rho(\pi, 1), ..., \ \hat\rho(\pi, k)]^\top</script> and obtain the regression errors  <script type="math/tex">\hat \xi := \hat Y - Y</script>.</p>
  </li>
  <li>
    <p>Create pseudo-noises <script type="math/tex">\xi^* := \hat \xi \odot \sigma^*</script>, where <script type="math/tex">\odot</script> represents Hadamard product and <script type="math/tex">\sigma^* \in \mathbb{R}^{k \times 1}</script> is Rademacher random variable (i.e., <script type="math/tex">\forall i \in [1,k], \,\, \Pr(\sigma_i^*=+1) = \Pr(\sigma_i^*=-1) = 0.5</script>).</p>
  </li>
  <li>
    <p>Create pseudo-performances  <script type="math/tex">Y^* := \hat Y + \xi^*</script>, to obtain pseudo-samples for <script type="math/tex">\hat Y</script> and <script type="math/tex">\hat \rho (\pi, {k+\delta})</script> as <script type="math/tex">\hat Y^* = \Phi(\Phi^\top  \Phi)^{-1}\Phi^\top Y^*</script> and  <script type="math/tex">\hat \rho (\pi, {k+\delta})^* = \phi(k+\delta)(\Phi^\top  \Phi)^{-1}\Phi^\top Y^*.</script></p>
  </li>
</ol>

<p><br /></p>

<p align="center">
     <img src="/images/blog/spin/diffLB.png" alt="candidate" style="vertical-align:middle; width: 70%; margin:0px 10px; border-radius:0%" />
     </p>

<p>The above image provides a computational graph for quantifying the uncertainty in the forecasted performance.  Wild bootstrap leverages Rademacher variables <script type="math/tex">\sigma^*</script> and the errors from regression to repeat steps 2 and 3 above to create pseudo-performances. Based on these pseudo-performances, an empirical distribution and thus also the lower bound <script type="math/tex">\hat \rho^\text{lb}</script> for the future performance is obtained. We also show in our paper how the derivative of this lower bound <script type="math/tex">\hat \rho^\text{lb}</script> with respect to the policy parameters can be computed to search for a candidate policy <script type="math/tex">\pi_c</script> that maximizes the lower bound. Such a candidate policy will then have the highest chances of passing the safety test and providing a safe policy update.</p>

<h2 id="empirical-performance">Empirical performance</h2>

<p>We provide an empirical analysis on two simulated domains inspired by safety-critical real-world problems that exhibit non-stationarity. One is for the treatment of Type-1 diabetes and the other is for a recommender system. To understand the impact of different rates of non-stationarity, we conduct the experiment for varying degrees of <em>speed</em>, where speed of 0 represents stationary environment and higher speeds indicate quicker changes in the environment.</p>

<p><br /></p>
<p align="center">
 <img src="/images/blog/spin/results.png" alt="results" style="vertical-align:middle; width: 60%; margin:0px 10px; border-radius:0%" />
 </p>

<p>The above figure illustrates the safety violation rates and performances for the proposed method, SPIN, and a baseline safe policy improvement method that does not account for non-stationarity. Top-left plot illustrates a typical learning curve, where it can be noticed that SPIN updates a policy whenever there is room for a significant improvement over the (unknown) performance of <script type="math/tex">\pi^\text{safe}</script>. In the middle and the right plots it can be seen that both SPIN and the baseline method ensure safety in the stationary setting but the baseline method can result in unsafe policies more than the desired 5% threshold in the non-stationary setting. In comparison, SPIN provides policy improvement and maintains the failure rate near the desired 5% threshold always.</p>

<p><br />
 Further, our experimental results call into question the popular misconception that the stationarity assumption is not severe when changes are slow. In fact, it can be quite the opposite: Slow changes can be more deceptive and can make existing algorithms, which do not account for non-stationarity, more susceptible to deploying unsafe policies. For more details, we encourage the readers to check out the <a href="https://arxiv.org/abs/2010.12645"> paper</a>.</p>

<h2 id="open-questions">Open Questions</h2>

<ul>
  <li>
    <p>Our method relied upon an assumption that the performance of a policy changes smoothly over time in a non-stationary environment. While this seems natural for many problem settings, it is certainly not true always. Thankfully, identifying jumps or the function class best suited to model the trend is well-studied in the time-series literature. Can we leverage their goodness-of-fit tests to find a good parameterization for the trend or warn the user when this assumption is not true?</p>
  </li>
  <li>
    <p>Our smoothness assumption also departs from the conventional way of assuming Lipschitz smoothness on the dynamics and the reward function. However, this opens up the question about what does smoothness on the policy performance correspond to in the terms of changes in the dynamics and the reward function?</p>
  </li>
</ul>

    



<div class="post-tags">
  
    
    <a href="/tags.html#timeseries">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">timeseries</span>
    </a>
  
    
    <a href="/tags.html#nonstationary">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">nonstationary</span>
    </a>
  
    
    <a href="/tags.html#reinforcement">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">reinforcement</span>
    </a>
  
    
    <a href="/tags.html#safety">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">safety</span>
    </a>
  
    
    <a href="/tags.html#bootstrap">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">bootstrap</span>
    </a>
  
</div>
  </div>

  
  <section class="comments">
    <h2>Comments</h2>
    
<div id="disqus_thread"></div>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'http://localhost:4000/blog/spin';
      this.page.identifier = 'http://localhost:4000/blog/spin';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://yashchandak.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



  </section>

  <section class="related">
  <h2>Related Posts</h2>
  <ul class="posts-list">
    
      <li>
        <h3>
          <a href="/blog/prognosticator">
            Optimizing for the Future in Non-Stationary MDPs
            <small>23 Dec 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</section>

</div>

    </main>

    <!-- Optional footer content -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-128250681-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-128250681-1');
</script>

  </body>
</html>
